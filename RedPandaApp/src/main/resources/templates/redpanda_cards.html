<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head th:replace="~{_layout :: head(~{::title})}">
  <title>レッサーパンダ図鑑</title>
  <style>
    .rp-thumb {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .rp-name {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 1;
      overflow: hidden;
    }
    @media (max-width: 576px) {
      .rp-section-title { font-size: 1.05rem; }
      .rp-card .card-body { padding: .6rem .75rem; }
      .rp-meta { font-size: .85rem; }
    }
  </style>
</head>

<body th:replace="~{_layout :: shell(~{::content})}">
<main>
  <div th:fragment="content">

    <!-- ヘッダ行 -->
    <div class="d-flex align-items-center mb-3">
      <h1 class="h4 mb-0">レッサーパンダ図鑑</h1>
      <a class="btn btn-primary btn-sm ms-auto" th:href="@{/posts/new}">新規投稿</a>
    </div>

    <!-- 検索 -->
    <form class="row g-2 mb-3" th:action="@{/redpandas}" method="get">
      <div class="col-8 col-sm-6 col-lg-4">
        <input class="form-control" type="text" name="q" th:value="${q}" placeholder="名前・親・特徴で検索">
      </div>
      <input type="hidden" name="size" th:value="${size}">
      <div class="col-4 col-sm-auto">
        <button class="btn btn-outline-primary w-100" type="submit">検索</button>
      </div>
    </form>

    <!-- 在園中 -->
    <div class="d-flex align-items-center mb-2">
      <h2 class="rp-section-title mb-0">在園中</h2>
      <span class="badge bg-success-subtle text-success-emphasis ms-2" th:text="${inParkTotal} + ' 件'"></span>
    </div>

    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-3 mb-4">
      <div class="col" th:each="c : ${inParkCards}">
        <article class="card rp-card h-100 shadow-sm">
          <!-- 統一比率のサムネ（4:3） -->
          <div class="ratio ratio-4x3">
            <img th:src="@{${c.thumbUrl}}" alt="写真" class="rp-thumb" loading="lazy">
          </div>
          <div class="card-body">
            <h3 class="h6 card-title mb-1 rp-name">
              <a class="stretched-link text-decoration-none"
                 th:href="@{/redpandas/{n}(n=${c.panda.name})}"
                 th:text="${c.panda.name}">name</a>
            </h3>
            <div class="text-muted rp-meta">
              <span th:text="${c.panda.gender}">性別</span>
              <span th:text="${c.panda.birthDate}">生年月日</span>
            </div>
          </div>
        </article>
      </div>
      <div class="text-muted px-2" th:if="${#lists.isEmpty(inParkCards)}">在園中の個体はいません</div>
    </div>

    <!-- 過去在園 -->
    <div class="d-flex align-items-center mb-2">
      <h2 class="rp-section-title mb-0">過去在園</h2>
      <span class="badge bg-secondary-subtle text-secondary-emphasis ms-2" th:text="${pastTotal} + ' 件'"></span>
    </div>

    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-3 mb-3">
      <div class="col" th:each="c : ${pastCards}">
        <article class="card rp-card h-100 shadow-sm">
          <div class="ratio ratio-4x3">
            <img th:src="@{${c.thumbUrl}}" alt="写真" class="rp-thumb" loading="lazy">
          </div>
          <div class="card-body">
            <h3 class="h6 card-title mb-1 rp-name">
              <a class="stretched-link text-decoration-none"
                 th:href="@{/redpandas/{n}(n=${c.panda.name})}"
                 th:text="${c.panda.name}">name</a>
            </h3>
            <div class="text-muted rp-meta">
              <span th:text="${c.panda.gender}">性別</span> /
              <span th:text="${c.panda.birthDate}">生年月日</span>
            </div>
          </div>
        </article>
      </div>
      <div class="text-muted px-2" th:if="${#lists.isEmpty(pastCards)}">過去在園の個体はいません</div>
    </div>

    <!-- ページャ（在園／過去在園を同ページ番号で運用している現行仕様に合わせて表示） -->
    <nav class="d-flex justify-content-center" th:if="${inParkTotalPages > 1 or pastTotalPages > 1}">
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" th:classappend="${page == 0} ? 'disabled'">
          <a class="page-link" th:href="@{/redpandas(page=${0}, size=${size}, q=${q})}">最初</a>
        </li>
        <li class="page-item" th:classappend="${page == 0} ? 'disabled'">
          <a class="page-link" th:href="@{/redpandas(page=${page-1}, size=${size}, q=${q})}">前へ</a>
        </li>
        <li class="page-item disabled">
          <span class="page-link" th:text="${page+1}"></span>
        </li>
        <li class="page-item"
            th:classappend="${page+1 >= (inParkTotalPages > pastTotalPages ? inParkTotalPages : pastTotalPages)} ? 'disabled'">
          <a class="page-link" th:href="@{/redpandas(page=${page+1}, size=${size}, q=${q})}">次へ</a>
        </li>
        <li class="page-item"
            th:classappend="${page+1 >= (inParkTotalPages > pastTotalPages ? inParkTotalPages : pastTotalPages)} ? 'disabled'">
          <a class="page-link"
             th:href="@{/redpandas(page=${(inParkTotalPages > pastTotalPages ? inParkTotalPages : pastTotalPages)-1}, size=${size}, q=${q})}">
            最後
          </a>
        </li>
      </ul>
    </nav>
  </div>
</main>
</body>
</html>
